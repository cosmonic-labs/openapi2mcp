name: Generate MCP from OpenAPI

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
    unit:
      runs-on: ubuntu-latest
      steps:
        - name: Checkout repository
          uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8 # v5.0.0

        - name: cargo test
          run: cargo test

    e2e:
        runs-on: ubuntu-latest
        permissions:
            contents: write
            pull-requests: write

        steps:
            - name: Checkout repository
              uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8 # v5.0.0

            - uses: actions/setup-node@49933ea5288caeca8642d1e84afbd3f7d6820020 # v4.4.0
              with:
                node-version: 22.x

            - name: Setup wash CLI
              uses: wasmcloud/setup-wash-action@v1.0.0-rc.2

            - name: Build component
              uses: wasmcloud/actions/wash-build@v0.1.0

            - name: Generate MCP from OpenAPI spec
              run: ./scripts/test-e2e.sh
